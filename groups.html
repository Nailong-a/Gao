<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>高能英雄游戏社区</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#F97316',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    }
                },
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .bg-glass {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .card-hover {
                transition: all 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .btn-join {
                @apply bg-primary hover:bg-primary/90 text-white text-sm font-medium py-2 px-4 rounded-lg transition-colors;
            }
            .btn-joined {
                @apply bg-gray-200 text-gray-600 text-sm font-medium py-2 px-4 rounded-lg cursor-not-allowed;
            }
            .message-bubble {
                @apply rounded-lg p-3 my-2 max-w-[80%] break-words;
            }
            .message-bubble-left {
                @apply bg-gray-100 text-gray-800 rounded-tl-none;
            }
            .message-bubble-right {
                @apply bg-primary text-white rounded-tr-none;
            }
            .loading-spinner {
                @apply inline-block w-5 h-5 border-2 border-gray-200 border-t-primary rounded-full animate-spin;
            }
        }
    </style>
</head>
<body class="font-inter bg-gray-50 text-dark">
    <!-- 导航栏 -->
    <header class="fixed w-full z-50 transition-all duration-300" id="navbar">
        <div class="bg-glass border-b border-gray-200/30">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <!-- Logo -->
                    <div class="flex items-center">
                        <a href="index.html" class="flex items-center">
                            <span class="text-primary text-2xl font-bold">高能英雄</span>
                            <span class="ml-1 text-secondary text-xl">社区</span>
                        </a>
                    </div>
                    
                    <!-- 导航链接 - 桌面版 -->
                    <nav class="hidden md:flex space-x-8">
                        <a href="index.html" class="text-gray-900 hover:text-primary px-3 py-2 text-sm font-medium transition-colors">首页</a>
                        <a href="groups.html" class="text-primary border-b-2 border-primary px-3 py-2 text-sm font-medium">游戏群组</a>
                        <a href="upload.html" class="text-gray-900 hover:text-primary px-3 py-2 text-sm font-medium transition-colors">内容上传</a>
                    </nav>
                    
                    <!-- 用户区域 -->
                    <div class="flex items-center space-x-4">
                        <button id="show-my-groups" class="hidden md:flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 px-3 py-1.5 rounded-lg transition-colors">
                            <i class="fa fa-users text-primary"></i>
                            <span class="text-sm font-medium">我的群组</span>
                        </button>
                        <a href="profile.html" class="hidden md:flex items-center space-x-2">
                            <img src="https://picsum.photos/id/237/40/40" alt="用户头像" class="h-8 w-8 rounded-full object-cover">
                            <span class="text-sm font-medium">奶龙</span>
                        </a>
                        
                        <!-- 移动端菜单按钮 -->
                        <button id="mobile-menu-button" class="md:hidden inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-primary hover:bg-gray-100 focus:outline-none">
                            <i class="fa fa-bars text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 移动端菜单 -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-b border-gray-200">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="text-gray-900 hover:text-primary block px-3 py-2 text-base font-medium">首页</a>
                <a href="groups.html" class="text-primary font-medium block px-3 py-2 text-base">游戏群组</a>
                <a href="upload.html" class="text-gray-900 hover:text-primary block px-3 py-2 text-base font-medium">内容上传</a>
                <button id="mobile-show-my-groups" class="w-full text-left text-gray-900 hover:text-primary block px-3 py-2 text-base font-medium">
                    <i class="fa fa-users mr-2"></i>我的群组
                </button>
                <a href="profile.html" class="text-gray-900 hover:text-primary block px-3 py-2 text-base font-medium">
                    <div class="flex items-center space-x-2">
                        <img src="https://picsum.photos/id/237/40/40" alt="用户头像" class="h-8 w-8 rounded-full object-cover">
                        <span>奶龙</span>
                    </div>
                </a>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="pt-20 pb-12">
        <!-- 面包屑导航 -->
        <section class="bg-gray-100 py-4">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <nav class="flex" aria-label="面包屑">
                    <ol class="inline-flex items-center space-x-1 md:space-x-3">
                        <li class="inline-flex items-center">
                            <a href="index.html" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-primary">
                                <i class="fa fa-home mr-2"></i>首页
                            </a>
                        </li>
                        <li aria-current="page">
                            <div class="flex items-center">
                                <i class="fa fa-angle-right text-gray-400 mx-2"></i>
                                <span class="text-sm font-medium text-primary">游戏群组</span>
                            </div>
                        </li>
                    </ol>
                </nav>
            </div>
        </section>

        <!-- 群组列表区域 -->
        <section class="py-12">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                    <div>
                        <h2 class="text-2xl md:text-3xl font-bold mb-2">发现群组</h2>
                        <p class="text-gray-600">加入感兴趣的群组，结交志同道合的游戏好友</p>
                    </div>
                    
                    <div class="mt-4 md:mt-0 flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 w-full md:w-auto">
                        <div class="relative">
                            <input type="text" placeholder="搜索群组..." class="w-full sm:w-64 px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition-all">
                            <i class="fa fa-search absolute right-3 top-3 text-gray-400"></i>
                        </div>
                        
                        <select class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition-all">
                            <option value="">全部类别</option>
                            <option value="strategy">策略交流</option>
                            <option value="pvp">竞技对战</option>
                            <option value="casual">休闲娱乐</option>
                            <option value="tournament">赛事组织</option>
                            <option value="newplayer">新手指导</option>
                        </select>
                        
                        <select class="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary transition-all">
                            <option value="popular">热门程度</option>
                            <option value="newest">最新创建</option>
                            <option value="active">活跃程度</option>
                        </select>
                    </div>
                </div>

                <!-- 推荐群组 -->
                <div class="mb-10">
                    <h3 class="text-xl font-semibold mb-4">推荐加入的群组</h3>
                    <!-- 移除了群组卡片 -->
                </div>

                <!-- 创建群组按钮 -->
                <div class="mt-10 text-center">
                    <button id="create-group-btn" class="bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-8 rounded-lg shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1 flex items-center mx-auto">
                        <i class="fa fa-plus-circle mr-2"></i> 创建新群组
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- 我的群组侧边栏 -->
    <div id="my-groups-sidebar" class="fixed inset-y-0 left-0 transform -translate-x-full md:w-80 w-full bg-white shadow-xl z-40 transition-transform duration-300 ease-in-out">
        <div class="h-full flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold">我的群组</h3>
                <button id="close-my-groups" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4" id="my-groups-list">
                <!-- 我的群组将通过JavaScript动态添加 -->
                <div class="text-center text-gray-500 py-8">
                    <i class="fa fa-folder-open-o text-4xl mb-3"></i>
                    <p>您还没有加入任何群组</p>
                    <p class="text-sm">加入或创建群组开始聊天</p>
                </div>
            </div>
            
            <div class="p-4 border-t border-gray-200">
                <button id="create-group-btn-sidebar" class="w-full bg-secondary hover:bg-secondary/90 text-white font-medium py-2.5 px-4 rounded-lg transition-colors">
                    <i class="fa fa-plus-circle mr-2"></i> 创建新群组
                </button>
            </div>
        </div>
    </div>

    <!-- 遮罩层 -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>

    <!-- 聊天模态框 -->
    <div id="chat-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-xl h-[80vh] max-w-4xl w-full mx-4 flex flex-col transform transition-all duration-300 scale-95 opacity-0" id="chat-modal-content">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center mr-3">
                        <i class="fa fa-users text-primary"></i>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold" id="chat-group-name">游戏交流群</h3>
                        <p class="text-xs text-gray-500" id="chat-group-members">2,543 成员</p>
                    </div>
                </div>
                <button id="close-chat-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            
            <div class="flex-1 overflow-y-auto p-4" id="chat-messages">
                <!-- 聊天消息将通过JavaScript动态添加 -->
                <div class="flex items-center justify-center h-full">
                    <div class="text-center text-gray-500">
                        <i class="fa fa-comments-o text-4xl mb-3"></i>
                        <p>开始与群组成员聊天</p>
                    </div>
                </div>
            </div>
            
            <div class="p-4 border-t border-gray-200">
                <div class="flex items-center">
                    <input type="text" id="chat-input" placeholder="输入消息..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary mr-2">
                    <button id="send-chat-message" class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors">
                        <i class="fa fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 创建群聊模态框 -->
    <div id="create-group-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8 max-w-2xl w-full mx-4 transform transition-all duration-300 scale-95 opacity-0" id="create-modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">创建新群组</h2>
                <button id="close-create-modal" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="create-group-form" class="space-y-6">
                <!-- 群组名称 -->
                <div>
                    <label for="group-name" class="block text-sm font-medium text-gray-700 mb-2">群组名称</label>
                    <input type="text" id="group-name" name="group-name" class="block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary" placeholder="请输入群组名称" required>
                </div>
                
                <!-- 群组类别 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">群组类别</label>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <div class="relative">
                            <input type="radio" id="category-strategy" name="category" value="strategy" class="peer sr-only" required>
                            <label for="category-strategy" class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer peer-checked:border-primary peer-checked:bg-primary/5 transition-all">
                                <i class="fa fa-book text-primary mr-3"></i>
                                <span>策略交流</span>
                            </label>
                        </div>
                        
                        <div class="relative">
                            <input type="radio" id="category-pvp" name="category" value="pvp" class="peer sr-only" required>
                            <label for="category-pvp" class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer peer-checked:border-primary peer-checked:bg-primary/5 transition-all">
                                <i class="fa fa-trophy text-primary mr-3"></i>
                                <span>竞技对战</span>
                            </label>
                        </div>
                        
                        <div class="relative">
                            <input type="radio" id="category-casual" name="category" value="casual" class="peer sr-only" required>
                            <label for="category-casual" class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer peer-checked:border-primary peer-checked:bg-primary/5 transition-all">
                                <i class="fa fa-gamepad text-primary mr-3"></i>
                                <span>休闲娱乐</span>
                            </label>
                        </div>
                        
                        <div class="relative">
                            <input type="radio" id="category-tournament" name="category" value="tournament" class="peer sr-only" required>
                            <label for="category-tournament" class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer peer-checked:border-primary peer-checked:bg-primary/5 transition-all">
                                <i class="fa fa-calendar text-primary mr-3"></i>
                                <span>赛事组织</span>
                            </label>
                        </div>
                        
                        <div class="relative">
                            <input type="radio" id="category-newplayer" name="category" value="newplayer" class="peer sr-only" required>
                            <label for="category-newplayer" class="flex items-center p-3 border-2 border-gray-200 rounded-lg cursor-pointer peer-checked:border-primary peer-checked:bg-primary/5 transition-all">
                                <i class="fa fa-graduation-cap text-primary mr-3"></i>
                                <span>新手指导</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- 群组描述 -->
                <div>
                    <label for="group-description" class="block text-sm font-medium text-gray-700 mb-2">群组描述</label>
                    <textarea id="group-description" name="group-description" rows="4" class="block w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary" placeholder="请简要描述群组的主题和目的" required></textarea>
                </div>
                
                <!-- 群组类型 -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">群组类型</label>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center">
                            <input id="group-type-public" name="group-type" type="radio" value="public" class="h-4 w-4 text-primary focus:ring-primary border-gray-300" checked>
                            <label for="group-type-public" class="ml-2 block text-sm text-gray-700">公开群组 - 任何人都可以查看和申请加入</label>
                        </div>
                        <div class="flex items-center">
                            <input id="group-type-private" name="group-type" type="radio" value="private" class="h-4 w-4 text-primary focus:ring-primary border-gray-300">
                            <label for="group-type-private" class="ml-2 block text-sm text-gray-700">私密群组 - 只有邀请才能加入</label>
                        </div>
                    </div>
                </div>
                
                <!-- 提交按钮 -->
                <div class="pt-4 flex space-x-4">
                    <button type="button" id="cancel-create-group" class="w-1/2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-6 rounded-lg transition-colors">
                        取消
                    </button>
                    <button type="submit" id="submit-create-group" class="w-1/2 bg-secondary hover:bg-secondary/90 text-white font-medium py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all">
                        <span id="submit-button-text">创建群组</span>
                        <span id="submit-spinner" class="hidden ml-2">
                            <i class="fa fa-circle-o-notch fa-spin"></i>
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- 页脚 -->
    <footer class="bg-dark text-white pt-12 pb-6">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">高能英雄社区</h3>
                    <p class="text-gray-400 mb-4">
                        为游戏玩家打造的专业社区，分享游戏经验，结交游戏好友。
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-weibo text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa fa-wechat text-xl"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // 导航栏滚动效果
        const navbar = document.getElementById('navbar');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 10) {
                navbar.classList.add('bg-white', 'shadow-md');
                navbar.classList.remove('bg-glass');
            } else {
                navbar.classList.remove('bg-white', 'shadow-md');
                navbar.classList.add('bg-glass');
            }
        });
        
        // 移动端菜单切换
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
        
        // 我的群组侧边栏
        const myGroupsSidebar = document.getElementById('my-groups-sidebar');
        const showMyGroupsBtn = document.getElementById('show-my-groups');
        const mobileShowMyGroupsBtn = document.getElementById('mobile-show-my-groups');
        const closeMyGroupsBtn = document.getElementById('close-my-groups');
        const overlay = document.getElementById('overlay');
        
        function toggleMyGroupsSidebar() {
            myGroupsSidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
            document.body.classList.toggle('overflow-hidden');
            
            // 更新我的群组列表
            updateMyGroupsList();
        }
        
        showMyGroupsBtn.addEventListener('click', toggleMyGroupsSidebar);
        mobileShowMyGroupsBtn.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
            toggleMyGroupsSidebar();
        });
        closeMyGroupsBtn.addEventListener('click', toggleMyGroupsSidebar);
        overlay.addEventListener('click', () => {
            myGroupsSidebar.classList.add('-translate-x-full');
            chatModal.classList.add('hidden');
            createGroupModal.classList.add('hidden');
            overlay.classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        });
        
        // 更新我的群组列表 - 修复闭包问题
        function updateMyGroupsList() {
            const myGroupsList = document.getElementById('my-groups-list');
            const myGroups = JSON.parse(localStorage.getItem('myGroups')) || [];
            
            if (myGroups.length === 0) {
                myGroupsList.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fa fa-folder-open-o text-4xl mb-3"></i>
                        <p>您还没有加入任何群组</p>
                        <p class="text-sm">加入或创建群组开始聊天</p>
                    </div>
                `;
                return;
            }
            
            myGroupsList.innerHTML = '';
            
            myGroups.forEach(group => {
                const groupEl = document.createElement('div');
                groupEl.className = 'mb-3 cursor-pointer hover:bg-gray-50 rounded-lg p-3 transition-colors';
                groupEl.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center mr-3">
                            <i class="fa fa-users text-primary"></i>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h4 class="font-medium">${group.name}</h4>
                                <span class="text-xs text-gray-500">${formatTimeAgo(group.lastMessageTime)}</span>
                            </div>
                            <p class="text-sm text-gray-600 line-clamp-1">${group.lastMessage}</p>
                        </div>
                    </div>
                `;
                
                // 修复闭包问题 - 使用箭头函数
                groupEl.addEventListener('click', () => {
                    // 先关闭侧边栏
                    myGroupsSidebar.classList.add('-translate-x-full');
                    // 然后打开聊天窗口，添加延迟确保动画完成
                    setTimeout(() => {
                        openChatModal(group);
                    }, 300);
                });
                
                myGroupsList.appendChild(groupEl);
            });
        }
        
        // 聊天模态框
        const chatModal = document.getElementById('chat-modal');
        const chatModalContent = document.getElementById('chat-modal-content');
        const closeChatModalBtn = document.getElementById('close-chat-modal');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendChatMessageBtn = document.getElementById('send-chat-message');
        const chatGroupName = document.getElementById('chat-group-name');
        const chatGroupMembers = document.getElementById('chat-group-members');
        
        function openChatModal(group) {
            // 确保我们有正确的群组数据
            if (!group || !group.name) {
                console.error('无效的群组数据', group);
                showNotification('无法加载群组信息');
                return;
            }
            
            // 设置聊天窗口标题和成员数
            chatGroupName.textContent = group.name;
            chatGroupMembers.textContent = `${group.members} 成员`;
            
            // 显示聊天消息
            displayChatMessages(group.id);
            
            // 显示聊天窗口并添加动画
            chatModal.classList.remove('hidden');
            setTimeout(() => {
                chatModalContent.classList.remove('scale-95', 'opacity-0');
                chatModalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            overlay.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
            
            // 自动聚焦到输入框
            setTimeout(() => {
                chatInput.focus();
            }, 300);
        }
        
        function closeChatModal() {
            chatModalContent.classList.remove('scale-100', 'opacity-100');
            chatModalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                chatModal.classList.add('hidden');
                overlay.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }, 300);
        }
        
        closeChatModalBtn.addEventListener('click', closeChatModal);
        
        // 发送聊天消息
        sendChatMessageBtn.addEventListener('click', () => {
            const message = chatInput.value.trim();
            if (message === '') return;
            
            // 添加消息到界面
            const messageElement = document.createElement('div');
            messageElement.className = 'message-bubble message-bubble-right';
            messageElement.textContent = message;
            
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // 清空输入框
            chatInput.value = '';
            
            // 模拟发送到服务器
            console.log(`发送消息到群组: ${chatGroupName.textContent}, 内容: ${message}`);
            
            // 更新最后一条消息
            const myGroups = JSON.parse(localStorage.getItem('myGroups')) || [];
            const groupIndex = myGroups.findIndex(g => g.name === chatGroupName.textContent);
            if (groupIndex !== -1) {
                myGroups[groupIndex].lastMessage = message;
                myGroups[groupIndex].lastMessageTime = new Date().toISOString();
                localStorage.setItem('myGroups', JSON.stringify(myGroups));
            }
            
            // 模拟服务器回复
            setTimeout(() => {
                const replyElement = document.createElement('div');
                replyElement.className = 'message-bubble message-bubble-left';
                replyElement.innerHTML = `<div class="font-medium text-gray-900">系统</div>${message}`;
                
                chatMessages.appendChild(replyElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        });

        // 创建群组模态框
        const createGroupModal = document.getElementById('create-group-modal');
        const createModalContent = document.getElementById('create-modal-content');
        const createGroupBtn = document.getElementById('create-group-btn');
        const createGroupBtnSidebar = document.getElementById('create-group-btn-sidebar');
        const closeCreateModalBtn = document.getElementById('close-create-modal');
        const cancelCreateGroupBtn = document.getElementById('cancel-create-group');
        const createGroupForm = document.getElementById('create-group-form');
        const submitCreateGroupBtn = document.getElementById('submit-create-group');
        const submitButtonText = document.getElementById('submit-button-text');
        const submitSpinner = document.getElementById('submit-spinner');
        
        function openCreateGroupModal() {
            createGroupModal.classList.remove('hidden');
            setTimeout(() => {
                createModalContent.classList.remove('scale-95', 'opacity-0');
                createModalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            
            overlay.classList.remove('hidden');
            document.body.classList.add('overflow-hidden');
        }
        
        function closeCreateGroupModal() {
            createModalContent.classList.remove('scale-100', 'opacity-100');
            createModalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                createGroupModal.classList.add('hidden');
                overlay.classList.add('hidden');
                document.body.classList.remove('overflow-hidden');
            }, 300);
        }
        
        createGroupBtn.addEventListener('click', openCreateGroupModal);
        createGroupBtnSidebar.addEventListener('click', openCreateGroupModal);
        closeCreateModalBtn.addEventListener('click', closeCreateGroupModal);
        cancelCreateGroupBtn.addEventListener('click', closeCreateGroupModal);
        
        // 创建群组表单提交处理
        createGroupForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // 验证表单数据
            const groupName = document.getElementById('group-name').value.trim();
            if (!groupName) {
                showNotification('请输入群组名称');
                return;
            }
            
            const categoryElements = document.getElementsByName('category');
            let categorySelected = false;
            for (const el of categoryElements) {
                if (el.checked) {
                    categorySelected = true;
                    break;
                }
            }
            if (!categorySelected) {
                showNotification('请选择群组类别');
                return;
            }
            
            const groupDescription = document.getElementById('group-description').value.trim();
            if (!groupDescription) {
                showNotification('请输入群组描述');
                return;
            }
            
            // 显示加载状态
            submitButtonText.textContent = '创建中...';
            submitSpinner.classList.remove('hidden');
            submitCreateGroupBtn.disabled = true;
            
            try {
                // 获取表单数据
                const category = Array.from(categoryElements).find(el => el.checked).value;
                const groupType = Array.from(document.getElementsByName('group-type')).find(el => el.checked).value;
                
                // 构建请求数据
                const groupData = {
                    id: Date.now().toString(), // 生成唯一ID
                    name: groupName,
                    category: category,
                    description: groupDescription,
                    type: groupType,
                    creatorId: 'user123', // 示例用户ID，实际应从会话中获取
                    createdAt: new Date().toISOString(),
                    members: 1, // 创建者自己
                    lastMessage: '欢迎加入群组！',
                    lastMessageTime: new Date().toISOString()
                };
                
                // 模拟API调用 - 使用localStorage代替真实API
                // 实际应用中，这里应该有API调用将数据发送到服务器
                // 模拟延迟
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // 更新我的群组列表
                const myGroups = JSON.parse(localStorage.getItem('myGroups')) || [];
                myGroups.push(groupData);
                localStorage.setItem('myGroups', JSON.stringify(myGroups));
                
                // 成功创建群组后处理
                showNotification('群组创建成功！');
                
                // 关闭模态框
                closeCreateGroupModal();
                
                // 重置表单
                createGroupForm.reset();
                
                // 刷新我的群组列表
                updateMyGroupsList();
                
                // 自动打开新创建的群组聊天窗口
                setTimeout(() => {
                    openChatModal(groupData);
                }, 500);
                
            } catch (error) {
                console.error('创建群组失败:', error);
                showNotification('创建群组失败，请重试');
            } finally {
                // 恢复按钮状态
                submitButtonText.textContent = '创建群组';
                submitSpinner.classList.add('hidden');
                submitCreateGroupBtn.disabled = false;
            }
        });

        // 辅助函数
        function formatTimeAgo(timestamp) {
            const now = new Date();
            const messageDate = new Date(timestamp);
            const diff = now - messageDate;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (minutes < 1) {
                return '刚刚';
            } else if (minutes < 60) {
                return `${minutes} 分钟前`;
            } else if (hours < 24) {
                return `${hours} 小时前`;
            } else {
                return `${days} 天前`;
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-primary text-white p-3 rounded-lg shadow-md z-50';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function displayChatMessages(groupId) {
            // 假设这里有获取聊天消息的逻辑
            chatMessages.innerHTML = `
                <div class="flex items-center justify-center h-full">
                    <div class="text-center text-gray-500">
                        <i class="fa fa-comments-o text-4xl mb-3"></i>
                        <p>开始与群组成员聊天</p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
